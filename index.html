<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>å…¨åœ‹æ½”ç‰™æ¯”è³½æ¨¡æ“¬æ¸¬é©—</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background-color: #e3f2fd; padding: 20px; }
        .game-container { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 500px; text-align: center; }
        h1 { color: #007bff; font-size: 26px; margin-bottom: 10px; }
        .btn-container { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        button { padding: 14px; font-size: 16px; border: none; border-radius: 8px; background-color: #007bff; color: white; cursor: pointer; transition: 0.3s; }
        button:hover { background-color: #0056b3; }
        #score-display { margin-top: 20px; font-weight: bold; color: #28a745; font-size: 20px; }
        .info-text { color: #666; font-size: 14px; margin-bottom: 15px; }
        
        /* æ’è¡Œæ¦œæ¨£å¼ */
        #leaderboard { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; display: none; }
        .leaderboard-title { color: #f39c12; font-size: 20px; margin-bottom: 10px; }
        .leaderboard-list { list-style: none; padding: 0; text-align: left; background: #fff9f0; border-radius: 8px; overflow: hidden; }
        .leaderboard-item { padding: 10px 15px; border-bottom: 1px solid #ffeaa7; display: flex; justify-content: space-between; }
        .leaderboard-item:last-child { border-bottom: none; }
    </style>
</head>
<body>

<div class="game-container">
    <h1>å…¨åœ‹æ½”ç‰™æ¯”è³½æ¨¡æ“¬æ¸¬é©—</h1>
    <p class="info-text">æ¶µè“‹ç¯„åœï¼šç‰™é½’æ§‹é€ ã€ç™¼è‚²èˆ‡åˆ·ç‰™æ–¹æ³•</p>
    
    <div id="quiz-section">
        <h2 id="question" style="font-size: 20px; color: #333;">è¼‰å…¥ä¸­...</h2>
        <div id="options" class="btn-container"></div>
        <div id="score-display">ç›®å‰å¾—åˆ†ï¼š0</div>
    </div>

    <div id="leaderboard">
        <div class="leaderboard-title">ğŸ† å³æ™‚æ’è¡Œæ¦œ (Top 5)</div>
        <div id="leaderboard-list" class="leaderboard-list"></div>
        <button onclick="location.reload()" style="margin-top: 15px; background-color: #95a5a6;">é‡æ–°æŒ‘æˆ°</button>
    </div>
</div>

<script>
    // --- 1. å¾Œå°é€£ç·šè¨­å®š ---
    const SUB_URL = "https://wwbiondznucztprpgpaw.supabase.co";
    const SUB_KEY = "sb_publishable_62FaLOtoNtO9o-Zz05kbkA_VLv2pnWv";

    // --- 2. æ½”ç‰™æ¯”è³½é¡Œåº« (åƒè€ƒ PDF å…§å®¹) ---
    const quizData = [
        { q: "ä¹³é½’é½’åˆ—å…±æœ‰ 20 é¡†ï¼Œåœ¨å‡ºç”Ÿå¾Œ 6 å€‹æœˆæ™‚ï¼Œä¹³ç‰™å°±é–‹å§‹ç™¼è‚²ã€‚", a: ["å°", "éŒ¯"], correct: 0 },
        { q: "å£è…”å…§ç¬¬ä¸€é¡†é•·å‡ºçš„æ†ç‰™æ˜¯ä»€éº¼ï¼Ÿ", a: ["ä¸­é–€ç‰™", "ç¬¬ä¸€å¤§è‡¼é½’", "çŠ¬é½’", "æ™ºé½’"], correct: 1 },
        { q: "äººé¡ä¸€ç”Ÿæœ€å¤šå¯æ“æœ‰å¹¾é¡†ç‰™é½’ (ä¹³ç‰™ 20 é¡† + æ†ç‰™ 32 é¡†)ï¼Ÿ", a: ["28 é¡†", "32 é¡†", "52 é¡†", "60 é¡†"], correct: 2 },
        { q: "ä¸‹åˆ—ä½•è€…ç‚ºç‰™é½’æœ€å¤–å±¤çµæ§‹ï¼Ÿ", a: ["ç‰™é‡‰è³ª", "ç‰™æœ¬è³ª", "ç‰™é«“", "ç‰™éª¨è³ª"], correct: 0 },
        { q: "åˆ·ç‰™æœ€å¥½çš„æ™‚æ©Ÿæ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ", a: ["èµ·åºŠæ™‚", "é¤å¾ŒåŠç¡å‰", "æ´—æ¾¡æ™‚", "éš¨æ™‚éƒ½å¯ä»¥"], correct: 1 },
        { q: "åˆ·ç‰™æ™‚ï¼Œç‰™åˆ·æ‡‰å‚¾æ–œå¹¾åº¦å°æº–ç‰™é½¦èˆ‡ç‰™é½’äº¤ç•Œè™•ï¼Ÿ", a: ["15 åº¦", "45 åº¦", "60 åº¦", "90 åº¦"], correct: 1 },
        { q: "å»ºè­°æ¯æ¬¡åˆ·ç‰™çš„æ™‚é–“è‡³å°‘æ‡‰ç‚ºå¤šä¹…ï¼Ÿ", a: ["30 ç§’", "1 åˆ†é˜", "2~3 åˆ†é˜", "5 åˆ†é˜"], correct: 2 },
        { q: "ä½¿ç”¨ç‰™ç·šä¸»è¦æ˜¯ç‚ºäº†æ¸…é™¤ä»€éº¼ï¼Ÿ", a: ["é£Ÿç‰©æ®˜æ¸£", "ç‰™ç¸«ç‰™èŒæ–‘", "èˆŒè‹”", "ç‰™çµçŸ³"], correct: 1 },
        { q: "å«æ°Ÿç‰™è†çš„å»ºè­°æ¿ƒåº¦æ‡‰ç‚ºå¤šå°‘ ppm ä»¥ä¸Šï¼Ÿ", a: ["500 ppm", "800 ppm", "1000 ppm", "1500 ppm"], correct: 2 },
        { q: "ç‰™åˆ·æ‡‰å¤§ç´„æ¯éš”å¤šä¹…æ›´æ›ä¸€æ¬¡ï¼Ÿ", a: ["ä¸€é€±", "ä¸€å€‹æœˆ", "ä¸‰å€‹æœˆ", "åŠå¹´"], correct: 2 }
    ];

    let currentIdx = 0;
    let score = 0;

    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const scoreEl = document.getElementById('score-display');
    const quizSection = document.getElementById('quiz-section');
    const leaderboardSection = document.getElementById('leaderboard');

    // --- 3. éŠæˆ²é‚è¼¯ ---
    function loadQuiz() {
        const currentData = quizData[currentIdx];
        questionEl.innerText = "ç¬¬ " + (currentIdx + 1) + " é¡Œï¼š" + currentData.q;
        optionsEl.innerHTML = ''; 
        currentData.a.forEach((option, i) => {
            const btn = document.createElement('button');
            btn.innerText = option;
            btn.onclick = function() { checkAnswer(i); };
            optionsEl.appendChild(btn);
        });
    }

    function checkAnswer(selected) {
        if (selected === quizData[currentIdx].correct) {
            score += 10;
            alert("âœ… ç­”å°äº†ï¼");
        } else {
            const correctAns = quizData[currentIdx].a[quizData[currentIdx].correct];
            alert("âŒ ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š" + correctAns);
        }

        currentIdx++;
        if (currentIdx < quizData.length) {
            loadQuiz();
        } else {
            finishGame();
        }
        scoreEl.innerText = "ç›®å‰å¾—åˆ†ï¼š" + score;
    }

    async function finishGame() {
        quizSection.style.display = 'none';
        const userName = prompt("ğŸ‰ æ¸¬é©—å®Œæˆï¼ä½ çš„å¾—åˆ†æ˜¯ " + score + "ã€‚è«‹è¼¸å…¥åå­—ä»¥ç´€éŒ„æ’è¡Œæ¦œï¼š");
        if (userName) {
            await uploadScore(userName, score);
        }
        await getLeaderboard();
    }

    // --- 4. Supabase åŠŸèƒ½ (ä¸Šå‚³èˆ‡æŠ“å–) ---
    async function uploadScore(name, finalScore) {
        try {
            await fetch(SUB_URL + "/rest/v1/scores", {
                method: "POST",
                headers: {
                    "apikey": SUB_KEY,
                    "Authorization": "Bearer " + SUB_KEY,
                    "Content-Type": "application/json",
                    "Prefer": "return=minimal"
                },
                body: JSON.stringify({ username: name, score: finalScore })
            });
        } catch (e) { console.error(e); }
    }

    async function getLeaderboard() {
        try {
            const response = await fetch(SUB_URL + "/rest/v1/scores?select=username,score&order=score.desc&limit=5", {
                method: "GET",
                headers: {
                    "apikey": SUB_KEY,
                    "Authorization": "Bearer " + SUB_KEY
                }
            });
            const data = await response.json();
            
            const listEl = document.getElementById('leaderboard-list');
            listEl.innerHTML = '';
            leaderboardSection.style.display = 'block';

            data.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'leaderboard-item';
                div.innerHTML = `<span>ç¬¬ ${index + 1} å: ${item.username}</span> <span>${item.score} åˆ†</span>`;
                listEl.appendChild(div);
            });
        } catch (e) { console.error(e); }
    }

    window.onload = loadQuiz;
</script>

</body>
</html>