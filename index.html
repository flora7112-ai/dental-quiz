<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>å…¨åœ‹æ½”ç‰™æ¯”è³½æ¨¡æ“¬æ¸¬é©— - æ­£å¼ç‰ˆ</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background-color: #e3f2fd; padding: 20px; }
        .game-container { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 500px; text-align: center; }
        h1 { color: #007bff; font-size: 26px; margin-bottom: 10px; }
        .btn-container { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        button { padding: 14px; font-size: 16px; border: none; border-radius: 8px; background-color: #007bff; color: white; cursor: pointer; transition: 0.3s; }
        button:hover { background-color: #0056b3; }
        #score-display { margin-top: 20px; font-weight: bold; color: #28a745; font-size: 20px; }
        input[type="text"] { padding: 12px; width: 85%; border: 2px solid #ddd; border-radius: 8px; font-size: 18px; margin-bottom: 10px; outline: none; }
        input[type="text"]:focus { border-color: #007bff; }
        #leaderboard { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; display: none; }
        .leaderboard-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-size: 18px; }
        .daily-tag { color: #e67e22; font-weight: bold; margin-bottom: 10px; font-size: 18px; }
    </style>
</head>
<body>

<div class="game-container">
    <h1>å…¨åœ‹æ½”ç‰™æ¯”è³½æ¨¡æ“¬æ¸¬é©—</h1>
    
    <div id="start-screen">
        <p class="daily-tag">ğŸ“… 24å°æ™‚é™æ™‚æŒ‘æˆ°</p>
        <p>è«‹è¼¸å…¥æ‚¨çš„åå­—é–‹å§‹æ¸¬é©—ï¼š</p>
        <input type="text" id="player-name-input" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜" maxlength="10">
        <div class="btn-container">
            <button onclick="startGame()">é€²å…¥æ¸¬é©—</button>
        </div>
    </div>

    <div id="quiz-section" style="display: none;">
        <h2 id="question" style="font-size: 20px; line-height: 1.5;">è¼‰å…¥ä¸­...</h2>
        <div id="options" class="btn-container"></div>
        <div id="score-display">ç›®å‰å¾—åˆ†ï¼š0</div>
    </div>

    <div id="leaderboard">
        <h2 style="color: #f39c12;">ğŸ† ä»Šæ—¥æ’è¡Œæ¦œ (Top 5)</h2>
        <p style="font-size: 12px; color: #999;">åƒ…é¡¯ç¤ºéå» 24 å°æ™‚å…§çš„æœ€é«˜åˆ†ç´€éŒ„</p>
        <div id="leaderboard-list"></div>
        <button onclick="location.reload()" style="margin-top: 20px; background-color: #95a5a6;">é‡æ–°æŒ‘æˆ°</button>
    </div>
</div>

<script>
    // --- å¾Œå°é€£ç·šè¨­å®š ---
    const SUB_URL = "https://wwbiondznucztprpgpaw.supabase.co";
    const SUB_KEY = "sb_publishable_62FaLOtoNtO9o-Zz05kbkA_VLv2pnWv";

    // --- æ½”ç‰™æ¯”è³½ 12 é¡Œ (å››é¸ä¸€æ ¼å¼) ---
    const quizData = [
        { q: "ä¹³é½’é½’åˆ—å…±æœ‰å¹¾é¡†ç‰™é½’ï¼Ÿ", a: ["10é¡†", "20é¡†", "28é¡†", "32é¡†"], correct: 1 },
        { q: "å£è…”å…§ç¬¬ä¸€é¡†é•·å‡ºçš„æ†ç‰™é€šå¸¸æ˜¯ä»€éº¼ï¼Ÿ", a: ["ç¬¬ä¸€å¤§è‡¼é½’(å…­æ­²é½’)", "ä¸­é–€ç‰™", "çŠ¬é½’", "æ™ºé½’"], correct: 0 },
        { q: "äººé¡ä¸€ç”Ÿä¸­ï¼Œä¹³ç‰™(20é¡†)èˆ‡æ†ç‰™(32é¡†)ç¸½å…±æœƒæœ‰å¹¾é¡†ï¼Ÿ", a: ["28é¡†", "32é¡†", "50é¡†", "52é¡†"], correct: 3 },
        { q: "ç‰™é½’çµæ§‹ä¸­ï¼Œæœ€å¤–å±¤ä¸”æœ€å …ç¡¬çš„éƒ¨åˆ†æ˜¯ä»€éº¼ï¼Ÿ", a: ["ç‰™é‡‰è³ª", "ç‰™æœ¬è³ª", "ç‰™é«“", "ç‰™éª¨è³ª"], correct: 0 },
        { q: "åˆ·ç‰™æœ€å¥½çš„æ™‚æ©Ÿæ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ", a: ["èµ·åºŠå¾Œ", "é¤å¾ŒåŠç¡å‰", "æ´—æ¾¡æ™‚", "åƒç”œé»å‰"], correct: 1 },
        { q: "åˆ·ç‰™æ™‚ï¼Œç‰™åˆ·æ‡‰å‚¾æ–œå¹¾åº¦å°æº–ç‰™é½¦èˆ‡ç‰™é½’äº¤ç•Œè™•ï¼Ÿ", a: ["15åº¦", "45åº¦", "90åº¦", "180åº¦"], correct: 1 },
        { q: "è²æ°åˆ·ç‰™æ³•æ¯æ¬¡åˆ·å…©é¡†ç‰™ï¼Œæ©«å‘å¾€è¿”æ‡‰è‡³å°‘åˆ·å¹¾æ¬¡ï¼Ÿ", a: ["2æ¬¡", "5æ¬¡", "10æ¬¡", "100æ¬¡"], correct: 2 },
        { q: "å»ºè­°æ¯æ¬¡åˆ·ç‰™çš„æ™‚é–“è‡³å°‘æ‡‰ç‚ºå¤šä¹…ï¼Ÿ", a: ["30ç§’", "1åˆ†é˜", "2~3åˆ†é˜", "10åˆ†é˜"], correct: 2 },
        { q: "ä½¿ç”¨ç‰™ç·šä¸»è¦ç›®çš„æ˜¯æ¸…é™¤å“ªä¸€å€‹éƒ¨ä½çš„ç‰™èŒæ–‘ï¼Ÿ", a: ["å’¬åˆé¢", "èˆŒé ­è¡¨é¢", "ç‰™é„°æ¥é¢(ç‰™ç¸«)", "ç‰™æ ¹å°–å€"], correct: 2 },
        { q: "å«æ°Ÿç‰™è†å»ºè­°æ¿ƒåº¦æ‡‰åœ¨å¤šå°‘ ppm ä»¥ä¸Šæ‰æœ‰é˜²è›€æ•ˆæœï¼Ÿ", a: ["500 ppm", "800 ppm", "1000 ppm", "2000 ppm"], correct: 2 },
        { q: "ç‰™åˆ·åˆ·æ¯›é–‹èŠ±æˆ–å»ºè­°å¤§ç´„ä½¿ç”¨å¤šä¹…æ‡‰è©²æ›´æ›ï¼Ÿ", a: ["ä¸€å€‹æœˆ", "ä¸‰å€‹æœˆ", "åŠå¹´", "ä¸€å¹´"], correct: 1 },
        { q: "é—œæ–¼æ½”ç‰™ç¿’æ…£ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ", a: ["æ¼±å£æ°´å¯å–ä»£åˆ·ç‰™", "åƒå£é¦™ç³–å°±ä¸å¿…åˆ·ç‰™", "ç¡å‰åˆ·ç‰™æœ€é‡è¦", "ç‰™è†ç”¨è¶Šå¤šè¶Šå¥½"], correct: 2 }
    ];

    let currentIdx = 0;
    let score = 0;
    let playerName = "";

    function startGame() {
        const input = document.getElementById('player-name-input');
        if (!input.value.trim()) {
            alert("è«‹å…ˆè¼¸å…¥åå­—ï¼");
            return;
        }
        playerName = input.value;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-section').style.display = 'block';
        loadQuiz();
    }

    function loadQuiz() {
        const currentData = quizData[currentIdx];
        document.getElementById('question').innerText = `ç¬¬ ${currentIdx + 1} é¡Œï¼š${currentData.q}`;
        const optionsEl = document.getElementById('options');
        optionsEl.innerHTML = '';
        currentData.a.forEach((option, i) => {
            const btn = document.createElement('button');
            btn.innerText = option;
            btn.onclick = () => checkAnswer(i);
            optionsEl.appendChild(btn);
        });
    }

    function checkAnswer(selected) {
        if (selected === quizData[currentIdx].correct) {
            score += 10;
            alert("âœ… ç­”å°äº†ï¼");
        } else {
            alert(`âŒ ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${quizData[currentIdx].a[quizData[currentIdx].correct]}`);
        }
        currentIdx++;
        if (currentIdx < quizData.length) {
            loadQuiz();
        } else {
            finishGame();
        }
        document.getElementById('score-display').innerText = `ç›®å‰å¾—åˆ†ï¼š${score}`;
    }

    async function finishGame() {
        document.getElementById('quiz-section').style.display = 'none';
        await uploadScore(playerName, score);
        await getLeaderboard();
    }

    async function uploadScore(name, finalScore) {
        try {
            const response = await fetch(`${SUB_URL}/rest/v1/scores`, {
                method: "POST",
                headers: {
                    "apikey": SUB_KEY,
                    "Authorization": `Bearer ${SUB_KEY}`,
                    "Content-Type": "application/json",
                    "Prefer": "return=minimal"
                },
                body: JSON.stringify({ username: name, score: finalScore })
            });
        } catch (e) { console.error("ä¸Šå‚³å¤±æ•—:", e); }
    }

    async function getLeaderboard() {
        // è¨ˆç®— 24 å°æ™‚å‰çš„æ™‚é–“ (è§£æ±ºæ™‚å€å·®ç•°å•é¡Œ)
        const timeLimit = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();
        
        try {
            const response = await fetch(`${SUB_URL}/rest/v1/scores?select=username,score&created_at=gte.${timeLimit}&order=score.desc&limit=5`, {
                headers: { "apikey": SUB_KEY, "Authorization": `Bearer ${SUB_KEY}` }
            });
            const data = await response.json();
            const listEl = document.getElementById('leaderboard-list');
            listEl.innerHTML = '';
            document.getElementById('leaderboard').style.display = 'block';
            
            if (!data || data.length === 0) {
                listEl.innerHTML = '<p>ä»Šæ—¥å°šç„¡ç´€éŒ„ï¼Œå¿«ä¾†æ¶ä½”ç¬¬ä¸€åï¼</p>';
            } else {
                data.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'leaderboard-item';
                    div.innerHTML = `<span>ç¬¬ ${index + 1} å: ${item.username}</span><span>${item.score} åˆ†</span>`;
                    listEl.appendChild(div);
                });
            }
        } catch (e) { console.error("è®€å–æ’è¡Œæ¦œå¤±æ•—:", e); }
    }
</script>
</body>
</html>
